<section class="contract-detail">
  <div class="section-header">
    <h2 translate>contractDetail.heading</h2>
    <div class="section-header-button-group">
      <button mat-icon-button matTooltip="{{ 'action.reload' | translate }}"
        (click)="onReloadContract()">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-icon-button class="close-button" matTooltip="{{ 'action.close' | translate }}"
        (click)="onClose()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <div *ngIf="dlc && contractInfo">
    <div class="field-group">
      <label translate>contractDetail.eventId</label>
      <input class="event-id-input"
        [value]="contractInfo.oracleInfo.announcement.event.eventId" disabled>
    </div>
    <div class="field-group">
      <label translate>contractDetail.state</label>
      <input [value]="dlc.state" disabled>
    </div>
    <div class="field-group">
      <label translate>contractDetail.initiator</label>
      <input [value]="dlc.isInitiator" disabled>
    </div>
    
    <div class="spacer"></div>

    <div class="field-group">
      <label translate>contractDetail.contractMaturity</label>
      <input [(ngModel)]="contractMaturity" disabled>
    </div>
    <div class="field-group">
      <label translate>contractDetail.contractTimeout</label>
      <input [(ngModel)]="contractTimeout" disabled>
    </div>
    <div class="field-group">
      <label translate>contractDetail.feeRate</label>
      <input class="numeric" [value]="dlc.feeRate" disabled>
      <span translate>unit.satsPerVbyte</span>
    </div>

    <div class="spacer"></div>

    <label class="group-label" translate>contractDetail.collateral</label>
    <div class="field-group">
      <label translate>contractDetail.localCollateral</label>
      <input class="numeric" [value]="formatNumber(dlc.localCollateral)" disabled>
      <span translate>unit.sats</span>
    </div>
    <div class="field-group">
      <label translate>contractDetail.remoteCollateral</label>
      <input class="numeric" [value]="formatNumber(dlc.remoteCollateral)" disabled>
      <span translate>unit.sats</span>
    </div>
    <div class="field-group">
      <label translate>contractDetail.totalCollateral</label>
      <input class="numeric" [value]="formatNumber(dlc.totalCollateral)" disabled>
      <span translate>unit.sats</span>
    </div>

    <div class="spacer"></div>

    <div *ngIf="dlc.myPayout !== undefined && dlc.counterPartyPayout !== undefined && dlc.pnl !== undefined && dlc.rateOfReturn !== undefined" class="payout-group">
      <label class="group-label" translate>contractDetail.contractOutcome</label>
      <div class="field-group">
        <label translate>contractDetail.yourPayout</label>
        <input class="numeric" [value]="formatNumber(dlc.myPayout)" disabled>
        <span translate>unit.sats</span>
      </div>
      <div class="field-group">
        <label translate>contractDetail.counterpartyPayout</label>
        <input class="numeric" [value]="formatNumber(dlc.counterPartyPayout)" disabled>
        <span translate>unit.sats</span>
      </div>
      <div class="field-group">
        <label translate>contractDetail.pnl</label>
        <input class="numeric" [value]="dlc.pnl" disabled>
        <span translate>unit.sats</span>
      </div>
      <div class="field-group">
        <label translate>contractDetail.rateOfReturn</label>
        <input class="numeric" [value]="formatPercent(dlc.rateOfReturn, 2, false)" disabled>
        <span translate>unit.percent</span>
      </div>

      <div class="spacer"></div>
    </div>

    <div *ngIf="isEnum()" class="enum-outcomes">
      <label class="group-label" translate>contractDetail.outcomePayouts</label>
      <div class="enum-group" *ngFor="let l of Object.keys(getEnumContractDescriptor().outcomes)">
        <label class="outcome-label">{{ l }}</label>
        <input class="outcome-payout text-right" [value]="getOutcomeValue( getEnumContractDescriptor().outcomes[l] )" disabled>
        <span translate>unit.sats</span>
      </div>

      <div class="spacer"></div>
    </div>

    <!-- TODO : Enum Outcome -->

    <!-- TODO : Payout curve -->

    <div class="field-group">
      <label translate>contractDetail.dlcId</label>
      <input [value]="dlc.dlcId" disabled>
      <button mat-icon-button class="copy-button mat-icon-button-sm" 
        matTooltip="{{ 'action.copyToClipboard' | translate }}"
        (click)="copyToClipboard(dlc.dlcId)" [disabled]= "!dlc.dlcId">
        <mat-icon class="mat-icon-sm">content_copy</mat-icon>
      </button>
    </div>
    <div class="field-group">
      <label translate>contractDetail.contractInfo</label>
      <input [value]="dlc.contractInfo" disabled>
      <button mat-icon-button class="copy-button mat-icon-button-sm" 
        matTooltip="{{ 'action.copyToClipboard' | translate }}"
        (click)="copyToClipboard(dlc.contractInfo)" [disabled]= "!dlc.contractInfo">
        <mat-icon class="mat-icon-sm">content_copy</mat-icon>
      </button>
    </div>
    <div class="field-group">
      <label translate>contractDetail.contractId</label>
      <input [value]="dlc.contractId ? dlc.contractId : ''" disabled>
      <button mat-icon-button class="copy-button mat-icon-button-sm" 
        matTooltip="{{ 'action.copyToClipboard' | translate }}"
        (click)="copyToClipboard(dlc.contractId)" [disabled]= "!dlc.contractId">
        <mat-icon class="mat-icon-sm">content_copy</mat-icon>
      </button>
    </div>
    <!-- Only show tempContractId when there is not a final contractId -->
    <div *ngIf="!dlc.contractId" class="field-group">
      <label translate>contractDetail.tempContractId</label>
      <input [value]="dlc.tempContractId" disabled>
      <button mat-icon-button class="copy-button mat-icon-button-sm" 
        matTooltip="{{ 'action.copyToClipboard' | translate }}"
        (click)="copyToClipboard(dlc.tempContractId)" [disabled]= "!dlc.tempContractId">
        <mat-icon class="mat-icon-sm">content_copy</mat-icon>
      </button>
    </div>
    
    <ng-container *ngIf="showTransactionIds()">
      <div class="spacer"></div>
      <div class="field-group">
        <label translate>contractDetail.fundingTransactionId</label>
        <input [value]="dlc.fundingTxId ? dlc.fundingTxId : ''" disabled>
        <button mat-flat-button color="primary" class="mat-flat-button-sm"
          (click)="onRebroadcastFundingTransaction()"
          [disabled]="!isFundingTxRebroadcastable(dlc.state)">
          <span translate>contractDetail.rebroadcast</span>
        </button>
        <!-- TODO : Link -->
      </div>
      <div class="field-group">
        <label translate>contractDetail.closingTransactionId</label>
        <input [value]="dlc.closingTxId ? dlc.closingTxId : ''" disabled>
        <button mat-flat-button color="primary" class="mat-flat-button-sm"
          (click)="onRebroadcastClosingTransaction()"
          [disabled]="!dlc.closingTxId">
          <span translate>contractDetail.rebroadcast</span>
        </button>
        <!-- TODO : Link -->
      </div>
      <div class="field-group">
        <label translate>contractDetail.oracleAttestations</label>
        <input [(ngModel)]="oracleAttestations" [disabled]="!isExecutable(dlc.state)">
        <button mat-flat-button color="primary" class="mat-flat-button-sm"
          (click)="onOracleAttestations()"
          [disabled]="!isExecutable(dlc.state) || !oracleAttestations">
          <span translate>action.execute</span>
        </button>
      </div>
    </ng-container>
  </div>

  <div class="spacer"></div>

  <div *ngIf="!accept && !sign" class="button-group">
    <button mat-stroked-button color="warn" (click)="onCancelContract()"
      [disabled]="!isCancelable(dlc.state)">
      <span translate>contractDetail.cancelContract</span>
    </button>
    <button mat-stroked-button color="warn" (click)="onRefund()"
      [disabled]="!isRefundable(dlc.state)">
      <span translate>contractDetail.refundContract</span>
    </button>
    <!-- Don't have sha256 id to do this operation yet. -->
    <button mat-stroked-button (click)="onViewOnOracleExplorer()"
      disabled>
      <span translate>contractDetail.viewOnOracleExplorer</span>
    </button>
  </div>

  <div *ngIf="accept" class="accept-group">
    <h2 translate>contractDetail.signAcceptOffer</h2>
    <div class="description text-justify">
      {{ 'contractDetailDescription.signAcceptOffer' | translate }}
    </div>

    <form class="form-container" [formGroup]="form" autocomplete="off">
      <fieldset>
        <mat-form-field class="w-100">
          <mat-label translate>contractDetail.filename</mat-label>
          <input matInput formControlName="filename" type="text"
            placeholder="{{ 'contractDetail.defaultSignFilename' | translate }}">
          <app-more-info matSuffix tooltip="contractDetailDescription.filename"></app-more-info>
        </mat-form-field>
      </fieldset>
    </form>

    <div class="execute-container">
      <div class="button-group">
        <button mat-flat-button color="primary" (click)="onSign()"
          [disabled]="form.invalid || !dlc.isInitiator || executing || acceptSigned">
          <mat-icon class="material-icons-outlined">file_download</mat-icon>
          <span translate>action.execute</span>
        </button>
        <div class="spinner" [hidden]="!executing">
          <mat-spinner diameter="20"></mat-spinner>
        </div>
      </div>
    </div>
    <app-alert *ngIf="!dlc.isInitiator" [type]="AlertType.warn" message="contractDetailDescription.cannotBroadcastOwnSign" icon="check_circle"></app-alert>
    <app-alert *ngIf="acceptSigned" [type]="AlertType.success" message="contractDetail.acceptSigned" icon="check_circle"></app-alert>
  </div>

  <div *ngIf="sign" class="sign-group">
    <h2 translate>contractDetail.broadcastSigned</h2>
    <div class="description text-justify">
      {{ 'contractDetailDescription.broadcastSigned' | translate }}
    </div>

    <div class="execute-container">
      <div class="button-group">
        <button mat-flat-button color="primary" (click)="onBroadcast()"
          [disabled]="dlc.isInitiator || executing || signBroadcast">
          <!-- <mat-icon class="material-icons-outlined">file_download</mat-icon> -->
          <span translate>action.execute</span>
        </button>
        <div class="spinner" [hidden]="!executing">
          <mat-spinner diameter="20"></mat-spinner>
        </div>
      </div>
    </div>

    <app-alert *ngIf="dlc.isInitiator" [type]="AlertType.warn" message="contractDetailDescription.cannotBroadcastOwnSign" icon="check_circle"></app-alert>
    <app-alert *ngIf="signBroadcast" [type]="AlertType.success" message="contractDetail.signBroadcast" icon="check_circle"></app-alert>
  </div>

  <!-- <app-alert *ngIf="showDeleteSuccess" [type]="AlertType.success" message="Contract Deleted"></app-alert> -->
</section>
